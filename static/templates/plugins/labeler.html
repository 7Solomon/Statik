<div class="h-full flex flex-col">
    <!-- Header -->
    <div class="flex justify-between items-center mb-4 px-6 pt-4">
        <div class="flex items-center gap-4">
            <h2 class="text-2xl font-bold text-slate-800">System Labeler</h2>

            <!-- NEW: Grid Size Input -->
            <div class="flex items-center gap-2 bg-slate-100 px-3 py-1.5 rounded-lg border border-slate-200">
                <span class="text-xs font-semibold text-slate-500 uppercase">Raster (L):</span>
                <input type="number" id="grid-size-input" value="1.0" step="0.1" min="0.1"
                    class="w-16 bg-white border border-slate-300 rounded px-2 py-0.5 text-sm text-slate-700 focus:outline-none focus:border-blue-500"
                    onchange="updateGridSize(this.value)">
                <span class="text-xs text-slate-400">m</span>
            </div>
        </div>

        <div class="flex gap-2">
            <!-- Toggle Button will be injected here by JS or you can hardcode it -->
            <button onclick="toggleGrid()"
                class="px-4 py-2 bg-slate-100 text-slate-600 hover:bg-slate-200 rounded-lg transition-colors text-sm font-medium">
                Toggle Grid
            </button>
            <button onclick="clearCanvas()"
                class="px-4 py-2 bg-red-50 text-red-600 hover:bg-red-100 rounded-lg transition-colors text-sm font-medium">
                Clear All
            </button>
            <button onclick="saveSystem()"
                class="px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded-lg transition-colors text-sm font-medium shadow-sm">
                Save System
            </button>
        </div>
    </div>
    <!-- Main Content -->
    <div class="flex-1 flex gap-6 px-6 pb-6 min-h-0">
        <!-- Canvas Container -->
        <div class="flex-1 bg-white rounded-xl shadow-sm border border-slate-200 relative overflow-hidden cursor-crosshair"
            id="canvas-container">
            <canvas id="structure-canvas" class="absolute top-0 left-0 w-full h-full"></canvas>

            <!-- Coordinate display -->
            <div
                class="absolute bottom-4 left-4 bg-white/90 backdrop-blur px-3 py-1 rounded-md shadow-sm text-xs text-slate-500 font-mono border border-slate-200">
                x: <span id="coord-x">0.00</span>, y: <span id="coord-y">0.00</span>
            </div>
        </div>

        <!-- Tools Sidebar -->
        <div class="w-72 flex flex-col gap-4">
            <!-- Tool Selection -->
            <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                <h3 class="text-sm font-semibold text-slate-500 uppercase tracking-wider mb-3">Werkzeuge</h3>
                <div class="grid grid-cols-2 gap-2" id="tool-palette">
                    <!-- Node Tool -->
                    <button onclick="setTool('node')" id="btn-node"
                        class="tool-btn active p-3 rounded-lg border-2 border-blue-500 bg-blue-50 flex flex-col items-center gap-2 transition-all">
                        <div class="w-3 h-3 rounded-full bg-slate-800"></div>
                        <span class="text-xs font-medium text-slate-700">Knoten</span>
                    </button>

                    <!-- Member Tool -->
                    <button onclick="setTool('member')" id="btn-member"
                        class="tool-btn p-3 rounded-lg border-2 border-transparent hover:bg-slate-50 flex flex-col items-center gap-2 transition-all">
                        <div class="w-6 h-0.5 bg-slate-800"></div>
                        <span class="text-xs font-medium text-slate-700">Stab</span>
                    </button>
                </div>
            </div>

            <!-- Support Selection (Auflager) -->
            <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                <h3 class="text-sm font-semibold text-slate-500 uppercase tracking-wider mb-3">Auflager</h3>
                <div class="flex flex-col gap-2">
                    <!-- Festlager (Pinned) -->
                    <button onclick="setSupportType('fest')" id="btn-fest"
                        class="support-btn p-3 rounded-lg border border-slate-200 hover:border-blue-400 hover:bg-blue-50 flex items-center gap-3 transition-all text-left group">
                        <div class="w-8 h-8 flex items-center justify-center border border-slate-300 rounded bg-white">
                            <!-- Triangle Icon -->
                            <div
                                class="w-0 h-0 border-l-[6px] border-l-transparent border-r-[6px] border-r-transparent border-b-[10px] border-b-slate-600">
                            </div>
                        </div>
                        <div>
                            <div class="text-sm font-medium text-slate-700 group-hover:text-blue-700">Festlager</div>
                            <div class="text-[10px] text-slate-400">Fix: X, Y</div>
                        </div>
                    </button>

                    <!-- Loslager (Roller) -->
                    <button onclick="setSupportType('los')" id="btn-los"
                        class="support-btn p-3 rounded-lg border border-slate-200 hover:border-blue-400 hover:bg-blue-50 flex items-center gap-3 transition-all text-left group">
                        <div class="w-8 h-8 flex items-center justify-center border border-slate-300 rounded bg-white">
                            <!-- Circle/Roller Icon -->
                            <div class="w-3 h-3 rounded-full border-2 border-slate-600"></div>
                        </div>
                        <div>
                            <div class="text-sm font-medium text-slate-700 group-hover:text-blue-700">Loslager</div>
                            <div class="text-[10px] text-slate-400">Fix: Y (Rolls X)</div>
                        </div>
                    </button>

                    <!-- Einspannung (Fixed/Clamped) -->
                    <button onclick="setSupportType('einspannung')" id="btn-einspannung"
                        class="support-btn p-3 rounded-lg border border-slate-200 hover:border-blue-400 hover:bg-blue-50 flex items-center gap-3 transition-all text-left group">
                        <div class="w-8 h-8 flex items-center justify-center border border-slate-300 rounded bg-white">
                            <!-- Square/Block Icon -->
                            <div class="w-4 h-4 bg-slate-600"></div>
                        </div>
                        <div>
                            <div class="text-sm font-medium text-slate-700 group-hover:text-blue-700">Einspannung</div>
                            <div class="text-[10px] text-slate-400">Fix: X, Y, R</div>
                        </div>
                    </button>

                    <!-- Delete Support -->
                    <button onclick="setSupportType('none')" id="btn-none"
                        class="support-btn active p-3 rounded-lg border border-blue-500 bg-blue-50 flex items-center gap-3 transition-all text-left">
                        <div
                            class="w-8 h-8 flex items-center justify-center border border-slate-300 rounded bg-white text-slate-400">
                            x
                        </div>
                        <div>
                            <div class="text-sm font-medium text-slate-700">Kein Lager</div>
                            <div class="text-[10px] text-slate-400">Knoten frei</div>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Instructions -->
            <div class="bg-blue-50 p-4 rounded-xl border border-blue-100 text-xs text-blue-800">
                <p class="font-semibold mb-1">Anleitung:</p>
                <ul class="list-disc list-inside space-y-1 opacity-80">
                    <li>Klicke, um <strong>Knoten</strong> zu setzen.</li>
                    <li>Ziehe zwischen Knoten, um <strong>Stäbe</strong> zu erstellen.</li>
                    <li>Wähle ein <strong>Lager</strong> und klicke auf einen Knoten, um es zuzuweisen.</li>
                </ul>
            </div>
        </div>
    </div>
</div>